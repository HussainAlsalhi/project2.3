<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Accept Contents</title>
        <link rel="stylesheet" href="cover_page.css">
        <link rel="stylesheet" href="ScrollBar.css">
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width , initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
   
    </head>

    <body>
    </br></br></br></br>
    <div class="jumbotron text-center">
    <h2>Internet Technology</h2>
    <p>This Page You Can View,Add,Update And Delete Content </p> 
  </div>
  
    <div class="progress-container">
        <div class="progress-bar" id="myBar"></div>
    </div> 
        <div class="container">
            <!--start searsh now-->
             <div class="input-group mb-3">
                <input id="SearchBar" type="text" class="form-control" placeholder="Search in content" aria-label="Recipient's username" aria-describedby="button-addon2">
               
                <div class="input-group-append">
                <select class="custom-select" id="CategorySelected">
                   <option selected value="1"> By Subject Name</option>
                   <option value="2">By type</option>
                   <!---- <option value="3">sno</option>-->
                  </select>
                <button id="SearchBtn" class="color" type="button">Search</button>
            </div>
        </div>
         
        <hr>
        <table class="table table-hover table-dark">
            <thead>
              <th>Number content</th>
              <th>Subject Name</th>
              <th>Content Type</th>
              <th>Link</th>
             <!---- <th>course</th>-->
              <th>Control Center</th>
            </thead>
            <tbody id="tbody1"></tbody>
</table>
<input type="NameTbox"placeholder="Subject Name" type="text" oninput="Update(this.value,'name')"><br><br>
<input type="TypeTbox" placeholder="Content Type" type="text" oninput="Update(this.value,'type')" list="type_content"><br><br>
         <datalist id="type_content">
       <option>Pdf</option>
       <option>File</option>
       <option>Youtube</option>
       <option>Udemy</option>
       <option>Coursera</option>
       <option>Linked learning</option>
       <option>Other website please write</option>
     </datalist>
		 <input type="LinkTbox" placeholder="Link" type="text" oninput="Update(this.value,'link')"><br><br>
         <input type="CourseTbox" placeholder="Confirm course" class="text4" type="text" oninput="Update(this.value,'course')"list="course_content" readonly><br><br>
            <datalist id="course_content">
                
                <option selected>Internet Technologies</option>
            
            </datalist>
         <button id="insertBtn"class="btn btn-primary my-2 type="type="button">Upload</button><br>
         <input type="text" placeholder="File Name" id="namebox"><label id="extlab"></label> <br><br>
       <!--<img id="myimg"--><label id="upprogress"></label><br><br>

       <button id="selbtn">select file</button>
       <button id="upbtn">upload file</button>
       <!--<button id="downbtn">Retrieve image</button>-->
        <div class="more-space">this page is connect %99.9 in database</div>
        <div class="more-space">-------------------------------------------------------------</div>
</div>

  <!-- Modal start-->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Control Panel</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <label class="labs">Subject Name: </label>
            <input type="text" id="NameMod"><br>

            <label class="labs">Link: </label>
            <input type="text" id="LinkMod"><br>

            <label class="labs">Type Content: </label>
            <input type="text" id="TypeMod"><br>

            <label class="labs">Course Content: </label>
            <input type="text" id="CourseMod"><br>

          </div>
          <div class="modal-footer">
            <button id="AddModBtn" type="button" class="btn btn-primary" onclick="AddCou()">Add</button>
            <button id="UpdModBtn" type="button" class="btn btn-success" onclick="UpdCou()">Update</button>
            <button id="DelModBtn" type="button" class="btn btn-danger" onclick="DelCou()">Delete</button>
        </div>
        </div>
      </div>
</div>
<!--Model end-->
        <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>

        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

        <script id="MainScript">
        
        let NameT =document.getElementById('NameTbox');
            let TypeT =document.getElementById('TypeTbox');
            let LinkT =document.getElementById('LinkTbox');
            let CourseT =document.getElementById('CourseTbox');

            let nameV,typeV,linkV,courseV;

            function Update(val,type){
                if(type=='name') nameV=val;
				else if(type=='type') typeV=val;
                else if(type=='link') linkV=val;
                else if(type=='course') courseV=val;
            }


    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyCyUYNEh2VRCsjzxroR94OAkwokutPnDig",
        authDomain: "upload-5e782.firebaseapp.com",
        databaseURL: "https://upload-5e782-default-rtdb.firebaseio.com",
        projectId: "upload-5e782",
        storageBucket: "upload-5e782.appspot.com",
        messagingSenderId: "618683601583",
        appId: "1:618683601583:web:a8fd4ff9bf23812d74fa5a",
        measurementId: "G-20VYSZPGMZ"
        };
  
    // Initialize Firebase
    //const app = initializeApp(firebaseConfig);
    firebase.initializeApp(firebaseConfig);
    let db = firebase.firestore();
   // const analytics = getAnalytics(app);
   function Add_Doc_withID(){
             db.collection("Added_ISM362").doc(nameV).set(
                 {
                     name: nameV,
					 type: typeV,
                     link: linkV,
                     course: courseV
                     

                 }
                 
             )
             

             .then(function(){
                 console.log("Document writein with id",nameV);
                 alert("Content uploaded into page user");

                 location.reload();
             })
             .catch(function(error){
                 console.error("Error adding document",error);
             })
         }           
         document.getElementById('insertBtn').onclick=function(){
            Add_Doc_withID();
            window.onload=GetAllDataOnce();
           
         }


   var ConNo;
   var ConList =[];
    function GetAllDataOnce(){
        document.getElementById("tbody1").innerHTML="";
        ConNo=0;
        db.collection("ISM362").get().then((querySnapshot)=>{
            var ISM362 =[];
            querySnapshot.forEach(doc =>{
                 ISM362.push(doc.data());
            });
            AddAllItemToTheTable(ISM362);

        });
    }
    window.onload=GetAllDataOnce();
   
    function AddItemToTable(name,type,link,course){
       
        var tbody1 = document.getElementById("tbody1");
        var trow = document.createElement("tr");
        var td0 = document.createElement("td");
        var td1 = document.createElement("td");
        var td2 = document.createElement("td");
        var td3 = document.createElement("td");
        //var td4 = document.createElement("td");

        ConList.push([name,type,link,course]);
        td0.innerHTML = ++ConNo;
        td1.innerHTML = name;
        td2.innerHTML = type;
        td3.innerHTML ='<a href="'+link+'"target="_blank">please press here --</a>' ,link;
        //td4.innerHTML = course;
        td1.classList += "nameField";
        td2.classList += "typeField";
        //td2.classList += "linkField";
        trow.appendChild(td0);
        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        //trow.appendChild(td4);
        

        var ControlDiv = document.createElement("div");
        ControlDiv.innerHTML +='<button type="button" class="btn btn-primary my-2 ml-2" data-toggle="modal" data-target="#exampleModalCenter" onclick="FillTboxes('+ConNo+')"> Edit</button>'        
        trow.appendChild(ControlDiv);
        tbody1.appendChild(trow);
    }
        var ModName=document.getElementById('NameMod');
        var ModType=document.getElementById('TypeMod');
        var ModLink=document.getElementById('LinkMod');
        var ModCourse=document.getElementById('CourseMod');


        var BTNmodAdd =document.getElementById('AddModBtn');
        var BTNmodUpd =document.getElementById('UpdModBtn');
        var BTNmodDel =document.getElementById('DelModBtn');
        
        function FillTboxes(index){
            if(index==null){
                ModName.value = "";
                ModType.value = "";
                ModLink.value = "";
                ModCourse.value = "";
                BTNmodAdd.style.display='inline-block';
                BTNmodUpd.style.display='none';
                BTNmodDel.style.display='none';

            }
            else{
                --index;//becuse count in conNo start of 1 (++ConNo) 
                ModName.value = ConList[index][0];
                ModType.value = ConList[index][1];
                 ModLink.value = ConList[index][2];
                 ModCourse.value = ConList[index][3];

                ModName.disabled=true;
                ModCourse.disabled=true;
                BTNmodAdd.style.display='inline-block';
                BTNmodUpd.style.display='inline-block';
                BTNmodDel.style.display='inline-block';
            }

        }
        function AddCou(){
    db.collection("Added_ISM362").doc(ModName.value).set({
      

        name : ModName.value,
        type : ModType.value,
        link : ModLink.value,
        course : ModCourse.value,
          

        },alert("successfully added to course"),
        db.collection("ISM362").doc(ModName.value).delete().then(() => {
        console.log("Document successfully deleted!");
                    GetAllDataOnce();
                    $("#exampleModalCenter");
                    location.reload();
        }).catch((error) => {
            console.error("Error removing document: ", error);
        })
        );
  }

        function DelCou(){
        db.collection("ISM362").doc(ModName.value).delete().then(() => {
        console.log("Document successfully deleted!");
                    GetAllDataOnce();
                    $("#exampleModalCenter");
                    location.reload();
        }).catch((error) => {
            console.error("Error removing document: ", error);
        });
    }
            
    
    
        function UpdCou(){
                    db.collection("ISM362").doc(ModName.value).update({
                name: ModName.value,
                type: ModType.value,
                link: ModLink.value,
                course: ModCourse.value,
                })
                .then(() => {
                    console.log("Document successfully written!");
                            GetAllDataOnce();
                            $("#exampleModalCenter");
                            location.reload();
                })
                .catch((error) => {
                    console.error("Error writing document: ", error);
                });
            }

    function AddAllItemToTheTable(contentDocsList){
        ConNo=0;
        tbody.innerHTML="";
        contentDocsList.forEach(element =>{
            AddItemToTable(element.name,element.type,element.link,element.course);
        })
    }

    window.onload = GetAllDataOnce ;

    var SearchBar =document.getElementById("SearchBar");
    var SearchBtn =document.getElementById("SearchBtn");
    var category =document.getElementById("CategorySelected");
    var tbody =document.getElementById("tbody1");

    function SearchTable(category){

        var filter = SearchBar.value.toUpperCase();
        var tr =tbody.getElementsByTagName("tr");
        var found;

        for (let i = 0; i < tr.length; i++) {
            var td =tr[i].getElementsByClassName(category);

            for (let j = 0; j < td.length; j++) {
                if(td[j].innerHTML.toUpperCase().indexOf(filter) > -1){
                    found=true;
                }
            }
            if(found){
                tr[i].style.display="";
                found=false;
            }
            else{
                tr[i].style.display="none";
  
            }
        }

    }

    SearchBtn.onclick = function(){
        if(SearchBar.value=="");

        else if(category.value==1)
            SearchTable("nameField");

                else if(category.value==2)
                SearchTable("typeField");
            
         else if(category.value==3)
            SearchTable("linkField");
    }

  </script>
    <script>
    function mydark() {
        var element = document.body;
        element.classList.toggle("dark-mode");
    }
    </script>
    
    <!--this progress bar-->
    <script>
        window.onscroll = function() {myFunction()};
        
        function myFunction() {
          var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
          var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
          var scrolled = (winScroll / height) * 100;
          document.getElementById("myBar").style.width = scrolled + "%";
        }
    </script>
     <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
             
        const firebaseConfig = {
          apiKey: "AIzaSyCyUYNEh2VRCsjzxroR94OAkwokutPnDig",
          authDomain: "upload-5e782.firebaseapp.com",
          databaseURL: "https://upload-5e782-default-rtdb.firebaseio.com",
          projectId: "upload-5e782",
          storageBucket: "upload-5e782.appspot.com",
          messagingSenderId: "618683601583",
          appId: "1:618683601583:web:a8fd4ff9bf23812d74fa5a",
          measurementId: "G-20VYSZPGMZ"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        import {getStorage, ref as sRef, uploadBytesResumable, getDownloadURL ,deleteObject}
        from "https://www.gstatic.com/firebasejs/9.1.3/firebase-storage.js";

        //cloud firestore database 
        import {getFirestore, doc, getDoc, setDoc, collection, addDoc }
        from "https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";
        const db =getFirestore();

        //---------------------VERIABLES & REFERENCES--------------------------------------------------//
        var files = [];
        var reader = new FileReader();
        
        var namebox = document.getElementById('namebox');
        var extlab = document.getElementById('extlab');
        var myimg = document.getElementById('myimg');
        var proglab = document.getElementById('upprogress');
        var SelBtn = document.getElementById('selbtn');
        var UpBtn = document.getElementById('upbtn');
        var DownBtn = document.getElementById('downbtn');

        var input = document.createElement('input');
        input.type = 'file';

        input.onchange = e =>{
            files = e.target.files;

            var extention = GetFileExt(files[0]);
            var name = GetFileName(files[0]);

            namebox.value= name;
            extlab.innerHTML = extention;

            reader.readAsDataURL(files[0]);
        }
        reader.onload =function(){
            myimg.src = reader.result;
        }
        //-----------------------Selction------------------------
            SelBtn.onclick = function(){
                input.click();
            }
            function GetFileExt(file){
                var temp = file.name.split('.')
                var ext = temp.slice((temp.length-1),(temp.length));
                return '.'+ ext[0];
            }
            function GetFileName(file){
                var temp = file.name.split('.');
                var fname = temp.slice(0,-1).join('.');
                return fname;
            }
        //---------------------Uploading--------------------------------
        async function UploadProcess(){
            var ImgToUpload = files[0];

            var ImgName = namebox.value + extlab.innerHTML;

            const metaData ={
                contentType: ImgToUpload.type
            }
            const storage = getStorage();

            const storageRef = sRef(storage, "Files_ISM362/"+ImgName);

            const UploadTask = uploadBytesResumable(storageRef, ImgToUpload, metaData);

            UploadTask.on('state-changed',(snapshot)=>{
                var progess = (snapshot.bytesTransferred / snapshot.totalBytes)*100;
                proglab.innerHTML = "Upload "+progess+ "%";
            },
            (error) =>{
                alert("error: files not uploaded");
            },
            ()=>{
                alert("The content has been sent to the supervisor");
                getDownloadURL(UploadTask.snapshot.ref).then((downloadURL)=>{
                    SaveURLtoFirestore(downloadURL);
                });
            }
            );
        }
        //--------------------function for firestore database-----------------------------

        async function SaveURLtoFirestore(url){
            var name = namebox.value;
            var ext = extlab.innerHTML;

            var ref = doc(db, "Added_ISM362/"+name+ext);

            await setDoc(ref,{
                name: (name+ext),
                type: (ext),
                link: url,
                course: ("Internet technologies")
                
            },)     

        }
        UpBtn.onclick =UploadProcess;
      </script>
     <!--this progress bar-->

    <div class="dm"> Dark-mode </div>
    <label class="switch">
        <input type="checkbox"onclick="mydark()">
        <span class="slider round"> </span>
    </label>

    <div class="quarter_circle_top_left"></div>
    <div class="quarter_circle_top_right"></div>
    <div class="quarter_circle_bottom_left"></div>
    <div class="quarter_circle_bottom_right"></div>

</body>
</html>